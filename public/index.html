<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <title>Florr - Health Bars Return</title>
    <style>
        body { margin: 0; background: #1a1a1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        #topStats { position: absolute; top: 10px; width: 100%; text-align: center; color: white; font-size: 22px; font-weight: bold; pointer-events: none; text-shadow: 2px 2px 4px #000; z-index: 10; }
        #inventory { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 110px; background: rgba(0,0,0,0.5); border: 2px solid #444; border-radius: 10px; padding: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; pointer-events: none; }
        .slot { width: 40px; height: 40px; background: #222; border: 2px solid #555; border-radius: 5px; position: relative; overflow: hidden; }
        .reload-bar { position: absolute; bottom: 0; left: 0; width: 100%; background: #3498db; height: 0%; }
        #minimap { position: absolute; bottom: 20px; right: 20px; width: 150px; height: 150px; background: rgba(0,0,0,0.7); border: 2px solid #555; border-radius: 50%; overflow: hidden; }
        #waveText { position: absolute; top: 25%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; font-weight: bold; text-shadow: 0 0 30px rgba(255,255,255,0.8); pointer-events: none; opacity: 0; transition: 0.2s; z-index: 20; }
        #waveText.show { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
        .overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #333; padding: 40px; border-radius: 20px; text-align: center; color: white; z-index: 100; border: 4px solid #444; width: 350px; }
        button { padding: 12px 30px; font-size: 20px; background: #2ecc71; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="topStats">Score: <span id="scoreVal">0</span> | Next Wave: <span id="waveTimer">3</span>s</div>
    <div id="waveText">WAVE 1</div>
    <div id="inventory"></div>
    <canvas id="minimap"></canvas>

    <div id="startMenu" class="overlay">
        <h1>BOSS SLAYER</h1>
        <p>Health Bars are back!<br>Petals: 100k Damage</p>
        <button onclick="initGame()">START</button>
    </div>

    <div id="gameOver" class="overlay" style="display:none; background:#c62828;">
        <h1>YOU DIED</h1>
        <p>Final Score: <span id="finalScore">0</span></p>
        <button onclick="initGame()">RETRY</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script src="/socket.io/socket.io.js"></script>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const mCanvas = document.getElementById('minimap');
    const mCtx = mCanvas.getContext('2d');
    const waveDisplay = document.getElementById('waveText');

    const WORLD_RADIUS = 1500, RELOAD_TIME = 30; 
    let player, mobs, score, gameActive, isSprinting, isAttacking;
    let petals = [], particles = [], waveCount = 0, waveTimer = 3, petalAngle = 0, camera = { x: 0, y: 0 };
    const neonColors = ["#FF00FF", "#00FFFF", "#FFFF00", "#FF0000", "#00FF00", "#FF4500"];

    /* ðŸ”¹ MULTIPLAYER ADDITIONS (ONLY ADDED, NOTHING REMOVED) */
    let socket;
    let otherPlayers = {};

    function initGame() {
        socket = io("https://my-multiplayer-game-kpdz.onrender.com");

        socket.on("tick", (data) => {
            otherPlayers = data.players || {};
        });

        canvas.width = window.innerWidth; 
        canvas.height = window.innerHeight;
        score = 0; 
        gameActive = true; 
        particles = []; 
        waveCount = 0; 
        waveTimer = 3;

        player = { 
            x: 0, 
            y: 0, 
            radius: 35, 
            hp: 5000, 
            maxHp: 5000, 
            speed: 9, 
            petalDistance: 40 
        };

        petals = []; 
        document.getElementById('inventory').innerHTML = '';

        for(let i=0; i<20; i++) {
            const slot = document.createElement('div'); 
            slot.className = 'slot';
            const bar = document.createElement('div'); 
            bar.className = 'reload-bar';
            slot.appendChild(bar); 
            document.getElementById('inventory').appendChild(slot);
            petals.push({ active: true, timer: 0, ui: bar });
        }

        mobs = []; 
        document.getElementById('startMenu').style.display = "none"; 
        document.getElementById('gameOver').style.display = "none";

        const waveLoop = setInterval(() => {
            if(!gameActive) { 
                clearInterval(waveLoop); 
                return; 
            }
            if(--waveTimer <= 0) { 
                waveCount++; 
                triggerWave(); 
                spawnWave(); 
                waveTimer = 3; 
            }
            document.getElementById('waveTimer').innerText = waveTimer;
        }, 1000);

        requestAnimationFrame(gameLoop);
    }

    function triggerWave() {
        waveDisplay.innerText = waveCount % 10 === 0 ? "MEGA BOSS!" : "WAVE " + waveCount;
        waveDisplay.style.color = waveCount % 10 === 0 ? "#ff0000" : "#f1c40f";
        waveDisplay.classList.add('show'); 
        setTimeout(() => waveDisplay.classList.remove('show'), 1200);
    }

    function spawnWave() {
        if (waveCount % 10 === 0) spawnMob(true);
        else for(let i=0; i<5+(waveCount*2); i++) spawnMob(false);
    }

    function spawnMob(isBoss) {
        let a = Math.random() * Math.PI * 2, d = WORLD_RADIUS - 100;
        mobs.push({
            x: Math.cos(a)*d, 
            y: Math.sin(a)*d, 
            radius: isBoss ? 220 : 25,
            color: isBoss ? "#000" : "#c62828", 
            hp: isBoss ? 50000000 : 10000, 
            maxHp: isBoss ? 50000000 : 10000, 
            speed: isBoss ? 0.8 : 3.5, 
            isBoss: isBoss
        });
    }

    function drawHealthBar(x, y, radius, hp, maxHp) {
        const w = radius*2.5, h = 8;
        ctx.fillStyle = "#000"; 
        ctx.fillRect(x-w/2, y-radius-20, w, h);
        ctx.fillStyle = hp / maxHp > 0.5 ? "#2ecc71" : "#e74c3c";
        ctx.fillRect(x-w/2, y-radius-20, w*(hp/maxHp), h);
    }

    let mouseX = 0, mouseY = 0;
    window.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });

    function gameLoop() {
        if (!gameActive) return;

        camera.x = player.x - canvas.width/2; 
        camera.y = player.y - canvas.height/2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save(); 
        ctx.translate(-camera.x, -camera.y);

        ctx.beginPath(); 
        ctx.arc(0, 0, WORLD_RADIUS, 0, Math.PI*2); 
        ctx.fillStyle = "#76c043"; 
        ctx.fill();

        let angle = Math.atan2(mouseY - canvas.height/2, mouseX - canvas.width/2);
        player.x += Math.cos(angle) * player.speed;
        player.y += Math.sin(angle) * player.speed;

        /* ðŸ”¹ SEND POSITION */
        if (socket) {
            socket.emit("update", { x: player.x, y: player.y });
        }

        /* ðŸ”¹ DRAW OTHER PLAYERS */
        for (let id in otherPlayers) {
            if (!socket || id === socket.id) continue;
            const p = otherPlayers[id];
            ctx.fillStyle = "rgba(255,255,255,0.6)";
            ctx.beginPath();
            ctx.arc(p.x, p.y, player.radius, 0, Math.PI*2);
            ctx.fill();
        }

        ctx.fillStyle = "#ffeb3b"; 
        ctx.beginPath(); 
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2); 
        ctx.fill();

        ctx.restore(); 
        requestAnimationFrame(gameLoop);
    }
</script>
</body>
</html>
